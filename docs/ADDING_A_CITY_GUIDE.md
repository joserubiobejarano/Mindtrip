# Adding a City Guide

This guide covers the marketing-only city pages (no in-app itinerary UI).

## Where to add data
- `lib/seo/cities.ts`: add the city to `cityPages` for hub/metadata. Each entry must include `intent`, `contentLevel`, and `primaryKeyword` (see **When to use full vs lite** and **SEO data model** below).
- `lib/itinerary/city-itineraries.ts`: add full guide data under each locale (`en`, `es`).

## Default guide duration (2–3 days)
- **New city guides must default to 3 days.** Two-day guides are allowed for small or compact cities.
- **Do not create 4+ day guides as default guides.** Four-, five-, or seven-day content must be created later as explicit **duration variants**, each with:
  - a unique slug (e.g. `rome-4-days`),
  - a unique `primaryKeyword` (e.g. `"4 days in Rome"`),
  - distinct intent and content,
  - cross-linking between variants,
  - and canonicals where needed.
- **If a 4-day guide is generated by mistake** (e.g. by Cursor or tooling), correct it back to 2–3 days before shipping.

## Required fields (P0)
- `slug`, `city`, `country`, `days`, `pace`, `idealFor`, `style`
- `pacing` (3 short paragraphs for the “How to enjoy” block)
- `hero.title`, `hero.subtitle`, `hero.image.src`, `hero.image.alt`
- `cityStats` (3-5 items)
- `dayPlans` (length matches `days`; each day has `title`, `summary`, `morning`, `afternoon`, `evening`)
- `imageInfoCards` (3 cards with title, description, image) (still required for day-by-day image context)
- `logistics` (4+ items)
- `checklist` (6+ items)
- `faqs` (7 Q/A pairs)
- `relatedItineraries` (3 items with valid slugs that exist for the locale)
- `primaryCtaHref`, `secondaryCtaHref`

## SEO Copy Rules
- Meta title pattern (EN): `How to spend {days} days in {city} without Rushing`
- Meta title pattern (ES): `Cómo pasar {days} días en {city} sin ir muy apurado.`
- Meta description pattern (EN): `A full day-by-day {city} travel guide designed for first-time visitors. See the essentials, enjoy great food, and avoid overplanning.`
- Meta description pattern (ES): `Una guía de viaje completa de {city}, día a día y diseñada para quienes la visitan por primera vez. Visita lo esencial, disfruta de una excelente comida y evita planificar demasiado.`
- Spanish pages must fully localize all metadata:
  - `<title>`
  - Meta description
  - OpenGraph title and description
  - Twitter title and description
  - Section headings that appear in metadata or schema
  - No English strings allowed in Spanish metadata

## When to use full vs lite

Set `contentLevel` on each city in `cityPages`:

- **Full**: The guide meets P0 **and** minimum recommended depth (7 FAQs, 4+ logistics, 6+ checklist, custom hero/pacing, varied related itineraries). Use for flagship cities (e.g. Rome, Paris).
- **Lite**: Lighter content, more defaults, or hub-only (no full itinerary). Use for expanding coverage without full Rome-level investment.

## How intent affects indexing and CTAs

Set `intent` on each city in `cityPages`. Intent influences how we think about indexing and CTAs (implementation may follow later):

- **Informational**: Focus on traffic and topical authority; soft CTAs (e.g. “Explore more”).
- **Mixed**: Balance info and conversion; clear primary/secondary CTAs (e.g. “Plan your trip”).
- **Transactional**: Conversion-focused; stronger CTAs and signup/trip-creation prompts.

## Minimum recommended content depth for full guides

Full guides should align with `docs/GUIDE_QUALITY_CHECKLIST.md` P0 and P1:

- Hero, 3–5 city stats, 3 image cards, day plans matching `days`, 7 FAQs, 3 related itineraries, 4+ logistics, 6+ checklist, primary/secondary CTAs.
- Avoid heavy repetition across sections; include Spanish localization.

## SEO data model (`cityPages`)

Each city in `lib/seo/cities.ts` must define:

- `intent`: `"informational"` | `"mixed"` | `"transactional"`.
- `contentLevel`: `"full"` | `"lite"`.
- `primaryKeyword`: Canonical target phrase (e.g. `"3 days in Paris"`). **Must not duplicate** any other indexed city guide; dev warns via `[Guide SEO]` if duplicates are detected.

## Images

### Hero images
- Replicate same system we are using for older guides like Rome or Paris
- The system automatically normalizes these URLs via `/api/wikimedia` endpoint (see `lib/images/wikimedia.ts` and `components/itinerary/SafeImage.tsx`)
- Choose city-specific, recognizable landmarks or cityscapes that represent the destination well
- Avoid broken or generic URLs that don't match the city
- Alt text must be descriptive and city-specific, fully localized for Spanish pages

### Image info cards
- Use same system as in other guides
- Select images that show different aspects of the city (neighborhoods, landmarks, local life)
- Ensure all image URLs are valid and city-relevant

### Day-image cards (ES parity)
- The city page uses **English** city name and **English** day plan titles for image lookup (`getDayImageCards`) so EN and ES pages show the same day images.
- Returned cards are then mapped to the current locale’s day plan titles for display (Spanish titles on ES pages). When adding a new guide, keep EN and ES `dayPlans` in the same order and count so this mapping stays correct.

## Guardrails to expect in dev
- Missing sections or invalid image URLs will trigger `[Guide QA]` `console.warn` in dev.
- Related links are checked for missing/unknown slugs.
- Duplicate `primaryKeyword` across city guides triggers `[Guide SEO]` warnings.

## How to test locally
1. Run `npm run dev`.
2. Open:
   - `http://localhost:3000/cities/<slug>`
   - `http://localhost:3000/es/cities/<slug>`
   - `http://localhost:3000/cities`
   - `http://localhost:3000/es/cities`
3. Check the dev console for `[Guide QA]` warnings.
4. Verify hero image, stats, pacing block, FAQ, and related cards render.

## URLs to verify before shipping
- `/cities/<slug>`
- `/es/cities/<slug>`
- `/cities`
- `/es/cities`
